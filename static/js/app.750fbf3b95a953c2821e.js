webpackJsonp([1],{127:function(e,t){},128:function(e,t){},129:function(e,t){},130:function(e,t){},133:function(e,t,o){function n(e){o(128)}var i=o(15)(o(78),o(137),n,null,null);e.exports=i.exports},134:function(e,t,o){function n(e){o(130)}var i=o(15)(o(79),o(139),n,null,null);e.exports=i.exports},135:function(e,t,o){function n(e){o(129)}var i=o(15)(o(80),o(138),n,null,null);e.exports=i.exports},136:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"appContainer"}},[o("header-bar",{staticClass:"header-bar",attrs:{user:e.user,mainThread:e.mainThread},on:{login:e.login,logout:e.logout}}),e._v(" "),o("side-bar",{staticClass:"side-bar",attrs:{projects:e.projects,selectedProjectId:e.selectedProjectId,user:e.user,state:e.state,form:e.form},on:{toggleForm:e.toggleForm,updateSelectedProject:e.updateSelectedProject,toggleEditMode:e.toggleEditMode,updateProject:e.updateProject,deleteProject:e.deleteProject,drag:e.leftDrag}}),e._v(" "),o("hack-map",{staticClass:"hack-map",attrs:{projects:e.projects,selectedProjectId:e.selectedProjectId,user:e.user,floorplan:e.floorplan},on:{updateSelectedProject:e.updateSelectedProject,drop:e.centerDrop,closeModals:e.closeModals}})],1)},staticRenderFns:[]}},137:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"center-column",on:{click:e.closeModals}},[o("div",{staticClass:"droptarget",on:{dragenter:e.dragevent,dragover:e.dragevent,drop:e.drop}},[o("img",{staticClass:"floorplan",attrs:{src:e.floorplan.url}}),e._v(" "),e._l(e.projects,function(t){return t.x>0&&t.y>0&&e.floorplan.width>0&&e.floorplan.height>0?o("img",{key:t.id,staticClass:"marker",class:{selected:e.selectedProjectId===t.id},style:{left:e.floorplan.width*t.x-20+"px",top:e.floorplan.height*t.y-20+"px"},attrs:{width:"36",draggable:t.username===e.user.username||e.user.isAdmin,"data-id":t.id,src:t.avatar_thumbnail,alt:t.username,title:t.title},on:{dragstart:e.drag,click:function(o){o.stopPropagation(),e.updateSelectedProject(t.id)}}}):e._e()})],2)])},staticRenderFns:[]}},138:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"projects side-bar"},[o("div",{staticClass:"project-form",class:{open:e.form.isOpen}},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.form.title,expression:"form.title"}],attrs:{type:"text",placeholder:"Topic",maxlength:"40",autofocus:""},domProps:{value:e.form.title},on:{input:function(t){t.target.composing||(e.form.title=t.target.value)}}}),e._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.descriptionText,expression:"form.descriptionText"}],attrs:{placeholder:"Details (optional, uses markdown)"},domProps:{value:e.form.descriptionText},on:{input:function(t){t.target.composing||(e.form.descriptionText=t.target.value)}}}),e._v(" "),o("button",{staticClass:"add-button",on:{click:e.toggleForm}},[e._v("+ Add your hack")])]),e._v(" "),e.user.hasProject?o("button",{staticClass:"add-button",attrs:{title:"You've added a hack!",disabled:""}},[e._v("Hack Added!")]):o("button",{staticClass:"add-button",on:{click:e.toggleForm}},[e._v("+ Add your hack")]),e._v(" "),e._l(e.projects,function(t){return o("div",{key:t.id,staticClass:"project",class:{selected:e.selectedProjectId===t.id||t.editMode},attrs:{"data-id":t.id,draggable:!(e.selectedProjectId===t.id&&t.editMode)&&(t.username===e.user.username||e.user.isAdmin)},on:{dragstart:e.drag,click:function(o){e.updateSelectedProject(t.id)}}},[o("div",{staticClass:"project-title-bar"},[o("a",{staticClass:"project-author",attrs:{href:"https://github.com/"+t.username,draggable:"false"}},[e._v("@"+e._s(t.username))]),e._v(" "),t.editMode?o("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"project.title"}],staticClass:"project-title-editor",attrs:{type:"text",maxlength:"40",autofocus:""},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}):o("div",{staticClass:"project-title"},[e._v(e._s(t.title))])]),e._v(" "),o("img",{staticClass:"project-author-avatar",attrs:{src:e.selectedProjectId==t.id?t.avatar:t.avatar_thumbnail,title:t.username,alt:t.username,"data-dragicon":t.avatar_thumbnail,draggable:"false"}}),e._v(" "),t.editMode?o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.descriptionText,expression:"project.descriptionText"}],staticClass:"project-description-editor",domProps:{value:t.descriptionText},on:{input:function(e){e.target.composing||(t.descriptionText=e.target.value)}}}):o("div",{staticClass:"project-description",domProps:{innerHTML:e._s(t.descriptionHtml)}}),e._v(" "),e.selectedProjectId!=t.id&&!t.editMode||t.username!==e.user.username&&!e.user.isAdmin?e._e():o("div",{staticClass:"action-button-bar"},[t.editMode?e._e():o("a",{staticClass:"edit action-button",on:{click:function(o){e.toggleEditMode(t.id)}}},[e._v("Edit")]),e._v(" "),t.editMode?e._e():o("a",{staticClass:"delete action-button",on:{click:function(o){e.deleteComment(t.id)}}},[e._v("Delete")]),e._v(" "),t.editMode?o("a",{staticClass:"cancel action-button",on:{click:function(o){e.toggleEditMode(t.id)}}},[e._v("Cancel")]):e._e(),e._v(" "),t.editMode?o("a",{staticClass:"save action-button",on:{click:function(o){e.updateProject(t)}}},[e._v("Save")]):e._e()])])}),e._v(" "),"running"===e.state&&0===e.projects.length?o("div",{staticClass:"details"},[o("p",[e._v("No hacks yet, you can be the first!")])]):e._e(),e._v(" "),"init"===e.state?o("div",{staticClass:"loader"},[o("div",{staticClass:"loader1"}),e._v(" "),o("div",{staticClass:"loader2"}),e._v(" "),o("div",{staticClass:"loader3"})]):e._e()],2)},staticRenderFns:[]}},139:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"header-bar"},[o("h1",[e._v(e._s(e.mainThread.title))]),e._v(" "),o("div",{staticClass:"header-bar-links"},[o("a",{staticClass:"help-icon"},[e._v("Help"),o("div",{staticClass:"help-text",domProps:{innerHTML:e._s(e.mainThread.helpHtml)}})]),e._v(" "),e.user.username?o("a",{staticClass:"account-status",on:{click:e.logout}},[e._v(e._s(e.user.username)+" (Log out)")]):o("a",{staticClass:"account-status",attrs:{title:"Log in with GitHub"},on:{click:e.login}},[e._v("Log in")])])])},staticRenderFns:[]}},34:function(e,t,o){"use strict";var n=o(35),i=o.n(n),r=o(28),a=o.n(r),s=function(){var e=window.location.href.replace(window.location.hash,"");return e.indexOf("index.html")>=0?e.replace("index.html","oauth_redirect.html"):e+"oauth_redirect.html"}(),c="https://github.com/login/oauth/authorize?scope=public_repo&redirect_uri="+s+"&client_id=1b717d04ec7f3615bb18",l="https://bkkhackmap.herokuapp.com/authenticate/";a.a.options(l),t.a={isLoggedIn:function(){return!!window.localStorage.getItem("token")},logOut:function(){window.localStorage.removeItem("token")},getOAuthToken:function(){return new i.a(function(e,t){var o=window.localStorage.getItem("token");if(o)return void e(o);var n=window.open(c);window.addEventListener("oauth-code-received",function(o){var i=o.detail;a.a.get(l+i).then(function(t){window.localStorage.setItem("token",t.data.token),n.close(),e(t.data.token)}).catch(function(e){return t(e)})})})}}},53:function(e,t,o){function n(e){o(127)}var i=o(15)(o(77),o(136),n,null,null);e.exports=i.exports},73:function(e,t,o){"use strict";function n(e,t){var o={baseURL:a+(t||""),validateStatus:function(e){return e>=200&&(e<300||304===e)}};return e&&(o.headers={Authorization:"token "+e}),o}var i=o(28),r=o.n(i),a="https://api.github.com/";t.a=function(e,t,o){var i=r.a.create(n(o));return i.repo=r.a.create(n(o,"repos/"+e+"/"+t+"/")),i}},74:function(e,t,o){"use strict";var n=o(83),i=o.n(n),r=o(35),a=o.n(r),s=o(85),c=o.n(s),l=o(86),u=o.n(l),d=o(75),p=o(34),h=o(73),f=function(){function e(t){var n=this;c()(this,e),this.lastUpdateSent=new Date(0),this.config=t,this.github=o.i(h.a)(t.organization,t.repository),p.a.isLoggedIn()?this.ensureAuthenticatedClient().then(function(){return n.startPolling()}):this.startPolling()}return u()(e,[{key:"startPolling",value:function(){var e=this;this.getIssues().then(function(t){e.getMainThread(t)}).then(function(){return e.pollIssueForComments()}).catch(function(t){e.reportError(t),e.config.onError(t)})}},{key:"getIssues",value:function(){var e=this;return this.github.repo.get("issues",{params:{state:"all",labels:this.config.label},headers:d.a.commentFormat}).then(function(e){return e.data}).catch(function(t){throw e.reportError(t),new Error("Unable to get a list of issues from github")})}},{key:"getMainThread",value:function(e){var t=this;if(!e.length)throw new Error("Could not find an open issue labeled: "+this.config.label);var o=void 0;if(""===this.config.issueNumber)o=e[0];else if(void 0===(o=e.find(function(e){return e.number===parseInt(t.config.issueNumber)})))throw new Error("Could not find an open issue labeled: "+this.config.label+" and numbered: "+this.config.issueNumber);this.issueNumber=o.number;var n=d.a.deserializeIssueToMainThread(o);this.config.onMainThreadLoaded(n)}},{key:"postNewProject",value:function(e){return this.updateProjectAjaxCall(e,"post","issues/"+this.issueNumber+"/comments")}},{key:"updateProject",value:function(e){return this.updateProjectAjaxCall(e,"patch","issues/comments/"+e.id)}},{key:"updateProjectAjaxCall",value:function(e,t,o){var n=this;return this.ensureAuthenticatedClient().then(function(){n.lastUpdateSent=new Date;var i=d.a.serializeProjectToComment(e);return n.github.repo[t](o,{body:i},{headers:d.a.commentFormat})}).then(function(e){return d.a.deserializeCommentToProject(e.data)})}},{key:"deleteProject",value:function(e){var t=this;return this.ensureAuthenticatedClient().then(function(){return t.github.repo.delete("issues/comments/"+e)})}},{key:"pollIssueForComments",value:function(){var e,t=this,o="issues/"+this.issueNumber+"/comments",n=function n(r){var s=new Date,c=r?o+"?nocache="+s.getTime():o;return s-t.lastUpdateSent<15e3?(console.log("skipping poll because of a recent update from this client"),a.a.resolve()):window.document.hidden?(console.log("skipping poll because tab is hidden"),window.addEventListener("visibilitychange",n,{once:!0}),a.a.resolve()):(console.log("polling with etag "+e),t.github.repo.get(c,{headers:i()(d.a.commentFormat,e?{"If-None-Match":e}:{})}).then(function(o){if(console.log("poll response "+o.status),200===o.status){e=o.headers.etag;var n=t.pickFirstProjectPerUser(o.data);t.config.onProjectsUpdated(n)}}).catch(function(e){t.reportError(e),t.config.onError(new Error("Failed retrieving ideas"))}))};console.log("start polling");var r=1e3*this.config.pollIntervalSeconds;return window.setInterval(n,r),n(!0)}},{key:"pickFirstProjectPerUser",value:function(e){var t=[],o={};return e.forEach(function(e){var n=d.a.deserializeCommentToProject(e);o[n.username]||(o[n.username]=n,t.push(n))}),t}},{key:"ensureAuthenticatedClient",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.config.onAuthenticationRequired().then(function(t){if(!e.github.isAuthenticated)return e.github=o.i(h.a)(e.config.organization,e.config.repository,t),e.github.isAuthenticated=!0,e.github.get("user")}).then(function(t){t&&e.config.onUserAuthenticated(t)}).catch(function(o){if(console.log(o),p.a.logOut(),t)return e.github.isAuthenticated=!1,e.ensureAuthenticatedClient(!1)})}},{key:"deauthenticateClient",value:function(){p.a.logOut(),this.github=o.i(h.a)(this.config.organization,this.config.repository)}},{key:"reportError",value:function(e){console.error(e)}}]),e}();t.a=f},75:function(e,t,o){"use strict";function n(e){var t=e.slice(-1)[0],o=a.exec(t);return o?{x:o[1],y:o[2]}:{x:0,y:0}}var i=o(87),r=o.n(i),a=/<!-- ([.\d]+),([.\d]+) -->/,s=/<!--\s*floorplan\s*:\s*([^,\s]+),?\s*-->/;t.a={commentFormat:{Accept:"application/vnd.github.VERSION.full+json"},deserializeCommentToProject:function(e){var t=e.body.split("\r\n"),o=n(t),i=t[0],r=t.length>1?t[1].trim():"",a=e.body_html.substring(e.body_html.indexOf("\n")).trim();return{id:e.id,title:i,descriptionText:r,descriptionHtml:a,username:e.user.login,userId:e.user.id,userIsAdmin:"MEMBER"===e.author_association||"OWNER"===e.author_association,avatar_thumbnail:e.user.avatar_url+"&s=40",avatar:e.user.avatar_url+"&s=80",x:o.x,y:o.y,editMode:!1}},serializeProjectToComment:function(e){return e.title+"\r\n"+(e.descriptionText||"")+"\r\n\x3c!-- "+e.x+","+e.y+" --\x3e"},deserializeIssueToMainThread:function(e){var t=s.exec(e.body),o=r()(t,2),n=o[1];return{title:e.title,helpHtml:e.body_html,number:e.number,floorplanUrl:n}}}},76:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(55),i=o(54),r=o(53),a=o.n(r),s=o(52);o.n(s);n.a.config.productionTip=!1,n.a.use(i.a),o.i(s.polyfill)();var c=new i.a({base:window.location.pathname,routes:[{path:"/events/:issueNumber",name:"history",component:a.a,props:!0},{path:"*",name:"latest",component:a.a}]});new n.a({el:"#app",router:c,template:"<router-view />"})},77:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(74),i=o(34),r=o(134),a=o.n(r),s=o(135),c=o.n(s),l=o(133),u=o.n(l),d=void 0;t.default={name:"app",props:{issueNumber:{default:"",type:String}},data:function(){return{state:"init",mainThread:{title:"",helpText:""},floorplan:{url:"",width:0,height:0},selectedProjectId:"",projects:[],form:{isOpen:!1,title:"",descriptionText:""},authenticationUrl:"",user:{id:"",username:"",hasProject:!1,isAdmin:!1}}},methods:{toggleForm:function(){var e=this;return this.form.isOpen?(this.form.title=this.form.title.trim(),this.form.descriptionText=this.form.descriptionText.trim(),this.form.title||this.form.descriptionText?this.form.title?(d.postNewProject(this.form).then(function(t){e.projects.push(t),e.form.title="",e.form.descriptionText=""}).catch(function(e){return console.error(e)}),void(this.form.isOpen=!1)):void alert("Please enter a topic for your project"):void(this.form.isOpen=!1)):void(this.form.isOpen=!0)},leftDrag:function(e){var t=e.target.querySelector(".project-author-avatar"),o=document.createElement("img");o.src=t.dataset.dragicon,e.dataTransfer.setDragImage(o,20,20);var n=e.target.dataset.id;e.dataTransfer.setData("projectId",n)},updateSelectedProject:function(e){this.selectedProjectId=e},closeModals:function(){this.selectedProjectId=null,this.form.isOpen=!1},centerDrop:function(e){var t=e.dataTransfer.getData("projectId"),o=this.projects.filter(function(e){return e.id===parseInt(t)})[0];this.updateMapDimensions();var n=o.x,i=o.y,r=e.currentTarget.getBoundingClientRect(),a={x:r.left+document.documentElement.scrollLeft,y:r.top+document.documentElement.scrollTop},s=e.pageX-a.x,c=e.pageY-a.y;o.x=s/this.floorplan.width,o.y=c/this.floorplan.height,d.updateProject(o).catch(function(e){console.log("update rejected",e),o.x=n,o.y=i})},updateMapDimensions:function(){var e=this.$el.querySelector(".floorplan");this.floorplan.width=e.clientWidth,this.floorplan.height=e.clientHeight},login:function(){d.ensureAuthenticatedClient().then(function(e){return console.log(e)})},logout:function(){this.user.username="",d.deauthenticateClient()},toggleEditMode:function(e){var t=this.projects.findIndex(function(t){return t.id===e}),o=this.projects[t];o.editMode?(o.title=o.backup.title,o.descriptionText=o.backup.descriptionText):o.backup={title:o.title,descriptionText:o.descriptionText},o.editMode=!o.editMode},updateProject:function(e){var t=this;d.updateProject(e).then(function(e){var o=t.projects.findIndex(function(t){return t.id===e.id});t.$set(t.projects,o,e)}).catch(function(t){console.log("update rejected",t);var o=e.backup;e.title=o.title,e.descriptionText=o.descriptionText})},deleteProject:function(e){var t=this;d.deleteProject(e).then(function(){t.user.hasProject=!1,t.selectedProjectId=null;var o=t.projects.findIndex(function(t){return t.id===e});t.projects.splice(o,1)})},notifyError:function(e){e.hasOwnProperty("message")?alert(e.message):alert("Oh no, something went wrong")}},components:{HeaderBar:a.a,SideBar:c.a,HackMap:u.a},mounted:function(){var e=this;d=new n.a({organization:"bkkhack",repository:"hackmap",label:"BKKHack Main Thread",onAuthenticationRequired:i.a.getOAuthToken,pollIntervalSeconds:60,onProjectsUpdated:function(t){e.$set(e.$data,"state","running");var o=t.filter(function(t){return t.userId===e.user.id});o.length&&(e.user.hasProject=!0,e.user.isAdmin=o[0].userIsAdmin),e.projects.some(function(e){return e.editMode})||(e.projects=t)},onMainThreadLoaded:function(t){e.mainThread.helpHtml=t.helpHtml,e.mainThread.title=t.title,e.floorplan.url=t.floorplanUrl},onUserAuthenticated:function(t){e.user.username=t.data.login,e.user.id=t.data.id},issueNumber:this.issueNumber,onError:function(t){e.notifyError(t)}}),this.$el.querySelector(".floorplan").addEventListener("load",this.updateMapDimensions),this.updateMapDimensions(),window.addEventListener("resize",this.updateMapDimensions)},beforeDestroy:function(){window.removeEventListener("resize",this.updateMapDimensions)}}},78:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"hack-map",props:["mainThread","user","projects","selectedProjectId","floorplan"],methods:{dragevent:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},drag:function(e){var t=e.target.dataset.id;e.dataTransfer.setData("projectId",t)},drop:function(e){this.$emit("drop",e)},updateSelectedProject:function(e){this.$emit("updateSelectedProject",e)},closeModals:function(){this.$emit("closeModals")}}}},79:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"header-bar",props:["mainThread","user"],methods:{login:function(){this.$emit("login")},logout:function(){this.$emit("logout")}}}},80:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"sidebar",props:["form","projects","selectedProjectId","user","state"],methods:{toggleForm:function(){this.$emit("toggleForm")},drag:function(e){this.$emit("drag",e)},updateSelectedProject:function(e){this.$emit("updateSelectedProject",e)},toggleEditMode:function(e){this.$emit("toggleEditMode",e)},updateProject:function(e){this.$emit("updateProject",e)},deleteComment:function(e){this.$emit("deleteProject",e)}}}}},[76]);
//# sourceMappingURL=app.750fbf3b95a953c2821e.js.map